<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katoen Supply Chain - Stakeholder Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; color: white; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        
        /* Role Selection */
        .role-selector { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .role-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .role-card { background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 3px solid #e0e0e0; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .role-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(102,126,234,0.3); border-color: #667eea; }
        .role-card.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: #667eea; }
        .role-icon { font-size: 4em; margin-bottom: 15px; }
        .role-name { font-size: 1.3em; font-weight: 600; margin-bottom: 5px; }
        .role-desc { font-size: 0.9em; opacity: 0.8; }
        
        /* Dashboard Content */
        .dashboard { display: none; }
        .dashboard.active { display: block; }
        
        .card { background: white; border-radius: 12px; padding: 30px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        h2 { color: #333; margin-bottom: 20px; font-size: 24px; border-left: 4px solid #667eea; padding-left: 15px; }
        h3 { color: #555; margin: 20px 0 10px; font-size: 18px; }
        
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .info-item { padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; }
        .info-item strong { display: block; margin-bottom: 0.5rem; color: #2c3e50; font-size: 0.9rem; }
        .info-item span { color: #555; font-size: 1rem; word-break: break-all; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; color: #555; font-weight: 500; margin-bottom: 8px; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: border-color 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        
        .button { width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin: 5px 0; }
        .button:hover { background: #5568d3; transform: translateY(-2px); }
        .button-success { background: #10b981; }
        .button-success:hover { background: #059669; }
        .button-warning { background: #f59e0b; }
        .button-warning:hover { background: #d97706; }
        .button-danger { background: #ef4444; }
        .button-danger:hover { background: #dc2626; }
        .button-small { padding: 10px 20px; font-size: 14px; width: auto; display: inline-block; }
        
        .alert { padding: 15px; border-radius: 8px; margin: 15px 0; }
        .alert-success { background: #d1fae5; border: 2px solid #10b981; color: #065f46; }
        .alert-error { background: #fee2e2; border: 2px solid #ef4444; color: #991b1b; }
        .alert-info { background: #dbeafe; border: 2px solid #3b82f6; color: #1e40af; }
        .alert-warning { background: #fef3c7; border: 2px solid #f59e0b; color: #92400e; }
        
        .batch-list { margin-top: 1rem; }
        .batch-item { background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #10b981; cursor: pointer; transition: all 0.3s; }
        .batch-item:hover { background: #e9ecef; transform: translateX(5px); }
        
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-left: 10px; }
        .status-created { background: #dbeafe; color: #1e40af; }
        .status-verified { background: #d1fae5; color: #065f46; }
        .status-transit { background: #fef3c7; color: #92400e; }
        .status-checked { background: #ede9fe; color: #5b21b6; }
        .status-delivered { background: #d1fae5; color: #065f46; }
        .status-completed { background: #10b981; color: white; }
        
        .loading { text-align: center; padding: 40px; }
        .spinner { width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .task-list { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0; }
        .task-item { padding: 10px; margin: 10px 0; background: white; border-radius: 6px; border-left: 4px solid #667eea; }
        
        .alert { padding: 15px; border-radius: 8px; margin: 10px 0; }
        .alert-success { background: #d1fae5; border: 1px solid #10b981; color: #065f46; }
        .alert-error { background: #fee2e2; border: 1px solid #ef4444; color: #991b1b; }
    </style>
</head>
<body>
    <div class="container">
        <div style="margin-bottom: 20px;">
            <h1 style="margin: 0;">ğŸŒ¾ Katoen Supply Chain Dashboard</h1>
        </div>
        
        <!-- Import Custom Wallet -->
        <div class="card">
            <h2>ğŸ” Import DID Wallet (Optioneel)</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Nog geen DID? Gebruik dan eerst de knop hieronder om een nieuwe DID aan te maken. Je krijgt dan een private key die je hier kunt importeren.
            </p>
            <a href="register.html" target="_blank">
                <button class="button button-success" style="margin-bottom: 20px;">
                    â• Nieuwe DID Aanmaken
                </button>
            </a>
            <div class="form-group">
                <label>Private Key (van je geregistreerde DID):</label>
                <input type="password" id="customPrivateKey" placeholder="0x..." style="font-family: monospace;">
            </div>
            <button class="button" onclick="importCustomWallet()">Import Wallet</button>
            <div id="importResult" style="margin-top: 10px;"></div>
        </div>

        <!-- Role Selection -->
        <div class="role-selector">
            <h2 style="border: none; padding: 0; margin-bottom: 20px;">Selecteer uw rol:</h2>
            <div class="role-grid">
                <div class="role-card" onclick="selectRole('admin', 0)">
                    <div class="role-icon">âš™ï¸</div>
                    <div class="role-name">Admin</div>
                    <div class="role-desc">Systeem Beheer</div>
                </div>
                <div class="role-card" onclick="selectRole('farmer', 1)">
                    <div class="role-icon">ğŸ‘¨â€ğŸŒ¾</div>
                    <div class="role-name">Boer</div>
                    <div class="role-desc">Katoen Producent</div>
                </div>
                <div class="role-card" onclick="selectRole('transporter', 2)">
                    <div class="role-icon">ğŸš›</div>
                    <div class="role-name">Transporteur</div>
                    <div class="role-desc">Logistiek & Transport</div>
                </div>
                <div class="role-card" onclick="selectRole('certifier', 3)">
                    <div class="role-icon">ğŸ“œ</div>
                    <div class="role-name">Certificeerder</div>
                    <div class="role-desc">Kwaliteit Certificatie</div>
                </div>
                <div class="role-card" onclick="selectRole('cooperative', 5)">
                    <div class="role-icon">ğŸ¤</div>
                    <div class="role-name">Inkoop CoÃ¶peratie</div>
                    <div class="role-desc">Verwerking & Productie</div>
                </div>
                <div class="role-card" onclick="selectRole('processing', 6)">
                    <div class="role-icon">ğŸ­</div>
                    <div class="role-name">Verwerking t/m Retail</div>
                    <div class="role-desc">Verwerking tot Retail</div>
                </div>
                <div class="role-card" onclick="selectRole('custom', -1)">
                    <div class="role-icon">ğŸ”‘</div>
                    <div class="role-name">Custom DID</div>
                    <div class="role-desc">GeÃ¯mporteerde Wallet</div>
                </div>
            </div>
        </div>
        
        <!-- Account Info -->
        <div class="card">
            <div class="info-grid">
                <div class="info-item">
                    <strong>ğŸ‘¤ Huidige Account</strong>
                    <span id="currentAccount">Selecteer een rol</span>
                </div>
                <div class="info-item">
                    <strong>ğŸ’° ETH Balance</strong>
                    <span id="ethBalance">0 ETH</span>
                </div>
                <div class="info-item">
                    <strong>ğŸ’µ USDT Balance</strong>
                    <span id="usdtBalance">0 USDT</span>
                </div>
                <div class="info-item">
                    <strong>âœ… DID Status</strong>
                    <span id="didStatus">Geen DID</span>
                </div>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="dashboard-admin" class="dashboard">
            <div class="card">
                <h2>âš™ï¸ Admin Dashboard</h2>
                <div class="task-list">
                    <h3>ğŸ“‹ Uw Taken:</h3>
                    <div class="task-item">âœ… DID registreren voor alle stakeholders</div>
                    <div class="task-item">âœ… USDT tokens minten indien nodig</div>
                    <div class="task-item">âœ… Systeem status monitoren</div>
                </div>
            </div>

            <div class="card">
                <h2>1. DID Registratie voor Stakeholders</h2>
                <div class="form-group">
                    <label>Selecteer Stakeholder</label>
                    <select id="admin-stakeholder" onchange="adminFillAddress()">
                        <option value="">-- Selecteer --</option>
                        <option value="1">Account #1 - Boer</option>
                        <option value="2">Account #2 - Transporteur</option>
                        <option value="3">Account #3 - Certificeerder</option>
                        <option value="5">Account #5 - Inkoop CoÃ¶peratie</option>
                        <option value="6">Account #6 - Verwerking t/m Retail</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="admin-address" readonly>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <input type="text" id="admin-type" readonly>
                </div>
                <button class="button button-success" onclick="adminRegisterDID()">Registreer DID</button>
                <div id="admin-did-result"></div>
            </div>

            <div class="card">
                <h2>2. DID Status Overzicht</h2>
                <button class="button" onclick="adminCheckAllDIDs()">Check Alle DIDs</button>
                <div id="admin-did-overview"></div>
            </div>

            <div class="card">
                <h2>3. USDT Tokens Minten</h2>
                <div class="form-group">
                    <label>Ontvanger Address</label>
                    <input type="text" id="admin-mint-to" placeholder="0x...">
                </div>
                <div class="form-group">
                    <label>Bedrag (USDT)</label>
                    <input type="number" id="admin-mint-amount" value="10000">
                </div>
                <button class="button button-warning" onclick="adminMintUSDT()">Mint USDT</button>
                <div id="admin-mint-result"></div>
            </div>
        </div>

        <!-- FARMER DASHBOARD -->
        <div id="dashboard-farmer" class="dashboard">
            <div class="card">
                <h2>ğŸ‘¨â€ğŸŒ¾ Boer Dashboard</h2>
                <div class="task-list">
                    <h3>ğŸ“‹ Uw Taken:</h3>
                    <div class="task-item">ğŸŒ¾ Katoen oogsten en batch aanmaken</div>
                    <div class="task-item">ğŸ“Š Kwaliteit en hoeveelheid registreren</div>
                    <div class="task-item">ğŸ’° Betalingen ontvangen na levering</div>
                </div>
            </div>

            <div class="card">
                <h2>1. Nieuwe Katoen Batch Aanmaken</h2>
                <div class="alert alert-info">
                    <strong>â„¹ï¸ Info:</strong> Registreer uw geoogste katoen met gewicht en herkomst. Kwaliteit wordt automatisch random gegenereerd (60-100).
                </div>
                <div class="form-group">
                    <label>Gewicht (kg)</label>
                    <input type="number" id="farmer-weight" value="500">
                </div>
                <div class="form-group">
                    <label>Herkomst Locatie</label>
                    <input type="text" id="farmer-origin" value="Gujarat, India">
                </div>
                <button class="button button-success" onclick="farmerCreateBatch()">ğŸŒ¾ Maak Batch Aan (Random Kwaliteit)</button>
                <div id="farmer-create-result"></div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b;">
                <h2>ğŸ’° Farmer Escrow Beheer</h2>
                <div class="alert alert-warning">
                    <strong>â„¹ï¸ Escrow Balance:</strong> <span id="farmer-escrow-balance" style="font-size: 18px; font-weight: bold; color: #f59e0b;">Loading...</span> USDT
                </div>
                <div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 4px;">
                    <p style="margin: 0; font-size: 13px; color: #666;">
                        <strong>Wat is escrow?</strong><br>
                        Je moet een escrow storten om batches op de markt te kunnen zetten. Als een batch wordt afgekeurd, wordt de certificeerder fee (5%) uit jouw escrow betaald. Bij goedkeuring blijft je escrow intact.
                    </p>
                </div>
                <div class="form-group">
                    <label>Stort bedrag (USDT)</label>
                    <input type="number" id="farmer-escrow-amount" value="5000" min="1000">
                </div>
                <button class="button button-warning" onclick="farmerDepositEscrow()">ğŸ’³ Stort Escrow</button>
                <button class="button" onclick="farmerRefreshEscrow()">ğŸ”„ Ververs Balance</button>
                <div id="farmer-escrow-result"></div>
            </div>

            <div class="card">
                <h2>2. Mijn Batches</h2>
                <button class="button" onclick="farmerLoadBatches()">Ververs Batches</button>
                <div id="farmer-batches"></div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left: 4px solid #0ea5e9;">
                <h2>ğŸ“ Mijn Verifiable Credentials</h2>
                <div class="alert alert-info">
                    <strong>â„¹ï¸ Info:</strong> Hier ziet u alle certificaten (VCs) die aan u zijn toegekend door certificeerders. Deze bewijzen de kwaliteit en certificering van uw katoen.
                </div>
                <button class="button" onclick="farmerLoadVCs()" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);">ğŸ”„ Ververs VCs</button>
                <div id="farmer-vcs"></div>
            </div>
        </div>

        <!-- TRANSPORTER DASHBOARD -->
        <div id="dashboard-transporter" class="dashboard">
            <div class="card">
                <h2>ğŸš› Transporteur Dashboard</h2>
                <div class="task-list">
                    <h3>ğŸ“‹ Uw Taken:</h3>
                    <div class="task-item">ğŸ“¡ IoT sensor data registreren tijdens transport</div>
                    <div class="task-item">ğŸŒ¡ï¸ Temperatuur en luchtvochtigheid monitoren</div>
                    <div class="task-item">ğŸ“ GPS locatie bijhouden</div>
                </div>
            </div>

            <div class="card">
                <h2>1. Batch Tracking & IoT Data</h2>
                <div class="alert alert-info">
                    <strong>â„¹ï¸ Info:</strong> Track de batch en bekijk alle IoT sensor data. Als er nog geen IoT data is, wordt deze automatisch gegenereerd (10-15 records).
                </div>
                <div class="form-group">
                    <label>Batch ID</label>
                    <input type="number" id="trans-track" placeholder="1">
                </div>
                <div class="alert alert-warning">
                    <strong>ğŸ“¡ Automatische IoT Generatie:</strong><br>
                    â€¢ 10-15 random sensor readings<br>
                    â€¢ Temperatuur: 15-35Â°C<br>
                    â€¢ Luchtvochtigheid: 40-80%<br>
                    â€¢ Transport route: India â†’ Rotterdam
                </div>
                <button class="button button-success" onclick="transporterTrack()">ğŸ” Track Batch (Auto-genereer IoT als nodig)</button>
                <div id="trans-track-result"></div>
            </div>
        </div>

        <!-- CERTIFIER DASHBOARD -->
        <div id="dashboard-certifier" class="dashboard">
            <div class="card">
                <h2>ğŸ“œ Certificeerder Dashboard</h2>
                <div class="task-list">
                    <h3>ğŸ“‹ Uw Taken:</h3>
                    <div class="task-item">âœ… Verifiable Credentials uitgeven aan boeren</div>
                    <div class="task-item">ğŸŒ± Bio, Fairtrade en Kwaliteit certificaten beheren</div>
                    <div class="task-item">ğŸ“‹ Credentials koppelen aan batches</div>
                </div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                <h2 style="color: white;">ğŸ“œ Nieuwe VC Aanvraag Module</h2>
                <p style="margin-bottom: 15px;">Gebruik de nieuwe module voor een gestroomlijnde VC uitgave met validatie workflow.</p>
                <a href="vc-aanvraag.html" target="_blank" class="button" style="background: white; color: #059669; text-decoration: none; display: inline-block;">
                    ğŸš€ Open VC Aanvraag Module
                </a>
            </div>
        </div>

        <!-- COOPERATIVE DASHBOARD -->
        <div id="dashboard-cooperative" class="dashboard">
            <div class="card">
                <h2>ğŸ¤ Inkoop CoÃ¶peratie Dashboard</h2>
                <div class="task-list">
                    <h3>ğŸ“‹ Uw Taken:</h3>
                    <div class="task-item">ï¿½ Katoen batches op de markt bekijken en kopen</div>
                    <div class="task-item">ğŸ“‹ Gekochte batches laten certificeren</div>
                    <div class="task-item">ï¿½ğŸ”¬ Kwaliteitscontrole uitvoeren bij ontvangst</div>
                    <div class="task-item">âœ… Batch status updaten</div>
                </div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b;">
                <h2 style="color: #92400e;">ï¿½ Marktplaats - Beschikbare Batches</h2>
                <div class="alert alert-info" style="background: white;">
                    <strong>ğŸ’¡ Hoe werkt het?</strong><br>
                    1. Boeren plaatsen hun geoogste katoen batches op de markt<br>
                    2. Jij bekijkt de markt en kiest welke batch je wilt kopen<br>
                    3. Bij aankoop wordt het bedrag in escrow vastgezet in het smart contract<br>
                    4. Certificeerder keurt de batch goed of af<br>
                    5. Bij goedkeuring: escrow â†’ boer | Bij afkeuring: escrow â†’ jou (refund)
                </div>
                <button class="button" style="background: #f59e0b;" onclick="cooperativeLoadMarket()">ğŸ”„ Ververs Marktplaats</button>
                <div id="cooperative-market"></div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left: 4px solid #3b82f6;">
                <h2 style="color: #1e40af;">ğŸ“¦ Mijn Gekochte Batches (Wacht op Certificering)</h2>
                <div class="alert alert-info" style="background: white;">
                    <strong>â„¹ï¸ Info:</strong> Deze batches heb je gekocht en wachten op goedkeuring door de certificeerder. Het betaalde bedrag zit in escrow.
                </div>
                <button class="button" style="background: #3b82f6;" onclick="cooperativeLoadReservedBatches()">ğŸ”„ Ververs Mijn Batches</button>
                <div id="cooperative-reserved"></div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-left: 4px solid #10b981;">
                <h2 style="color: #065f46;">ğŸ“¤ Mijn Batches Doorverkopen</h2>
                <div class="alert alert-info" style="background: white;">
                    <strong>ğŸ’¡ Hoe werkt het?</strong><br>
                    1. Bekijk hieronder de batches die je hebt gekocht en die zijn goedgekeurd<br>
                    2. Plaats een batch op de secundaire markt voor verwerkers<br>
                    3. Verwerking tot en met Retail kan de batch dan kopen
                </div>
                <button class="button" style="background: #10b981;" onclick="cooperativeLoadMyBatches()">ğŸ”„ Ververs Mijn Batches</button>
                <div id="cooperative-my-batches"></div>
            </div>
        </div>

        <!-- PROCESSING TO RETAIL DASHBOARD -->
        <div id="dashboard-processing" class="dashboard">
            <div class="card">
                <h2>ğŸ­ Verwerking tot en met Retail Dashboard</h2>
                <div class="task-list">
                    <h3>ğŸ“‹ Uw Taken:</h3>
                    <div class="task-item">ğŸ›’ Batches kopen van inkoop coÃ¶peraties</div>
                    <div class="task-item">ğŸ­ Katoen verwerken tot eindproduct</div>
                    <div class="task-item">ğŸ“Š Productie en kwaliteit monitoren</div>
                    <div class="task-item">ğŸ›ï¸ Eindproducten naar retail distribueren</div>
                    <div class="task-item">âœ… Batch status bijwerken</div>
                </div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b;">
                <h2 style="color: #92400e;">ğŸ›’ Secundaire Marktplaats - Batches van CoÃ¶peraties</h2>
                <div class="alert alert-info" style="background: white;">
                    <strong>ğŸ’¡ Hoe werkt het?</strong><br>
                    1. Inkoop CoÃ¶peraties plaatsen hun gekochte en goedgekeurde batches hier<br>
                    2. Jij bekijkt de markt en kiest welke batch je wilt kopen<br>
                    3. Bij aankoop wordt de batch eigendom overgedragen<br>
                    4. Je kunt de batch dan verder verwerken tot retail producten
                </div>
                <button class="button" style="background: #f59e0b;" onclick="processingLoadMarket()">ğŸ”„ Ververs Secundaire Markt</button>
                <div id="processing-market"></div>
            </div>
        </div>
    </div>
    
    <script src="stakeholder-app.js"></script>
</body>
</html>

