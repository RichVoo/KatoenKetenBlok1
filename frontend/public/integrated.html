<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katoen Supply Chain - Complete Flow met USDT</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: white; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        
        .progress-bar { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .steps { display: flex; justify-content: space-between; align-items: center; position: relative; }
        .steps::before { content: ''; position: absolute; top: 30px; left: 10%; right: 10%; height: 4px; background: #e0e0e0; z-index: 0; }
        .step { display: flex; flex-direction: column; align-items: center; flex: 1; position: relative; z-index: 1; }
        .step-circle { width: 60px; height: 60px; border-radius: 50%; background: #e0e0e0; color: #999; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin-bottom: 10px; transition: all 0.3s ease; }
        .step-circle.active { background: #10b981; color: white; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }
        .step-circle.completed { background: #3b82f6; color: white; }
        .step-label { font-size: 12px; color: #999; font-weight: 500; text-align: center; }
        .step-label.active { color: #10b981; font-weight: 600; }
        .step-label.completed { color: #3b82f6; font-weight: 600; }
        
        .card { background: white; border-radius: 12px; padding: 40px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        h2 { color: #333; margin-bottom: 20px; font-size: 24px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; color: #555; font-weight: 500; margin-bottom: 8px; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: border-color 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; }
        textarea { resize: vertical; min-height: 100px; font-family: monospace; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        
        .button { width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s ease; margin-top: 10px; }
        .button:hover { background: #5568d3; transform: translateY(-2px); }
        .button-success { background: #10b981; }
        .button-success:hover { background: #059669; }
        .button-warning { background: #f59e0b; }
        .button-warning:hover { background: #d97706; }
        .button-small { padding: 10px 20px; font-size: 14px; width: auto; display: inline-block; margin: 5px; }
        
        .alert { padding: 15px; border-radius: 8px; margin: 15px 0; }
        .alert-success { background: #d1fae5; border: 2px solid #10b981; color: #065f46; }
        .alert-error { background: #fee2e2; border: 2px solid #ef4444; color: #991b1b; }
        .alert-info { background: #dbeafe; border: 2px solid #3b82f6; color: #1e40af; }
        .alert-warning { background: #fef3c7; border: 2px solid #f59e0b; color: #92400e; }
        
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .info-item { padding: 1rem; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #667eea; }
        .info-item strong { display: block; margin-bottom: 0.5rem; color: #2c3e50; font-size: 0.9rem; }
        .info-item span { color: #555; font-size: 1rem; word-break: break-all; }
        
        .loading { text-align: center; padding: 40px; }
        .spinner { width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .batch-list { margin-top: 1rem; }
        .batch-item { background: #f8f9fa; padding: 1rem; border-radius: 6px; margin-bottom: 0.5rem; border-left: 4px solid #10b981; cursor: pointer; transition: all 0.3s; }
        .batch-item:hover { background: #e9ecef; transform: translateX(5px); }
        
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .status-created { background: #dbeafe; color: #1e40af; }
        .status-verified { background: #d1fae5; color: #065f46; }
        .status-transit { background: #fef3c7; color: #92400e; }
        .status-checked { background: #ede9fe; color: #5b21b6; }
        .status-delivered { background: #d1fae5; color: #065f46; }
        .status-completed { background: #10b981; color: white; }
        
        .account-switcher { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1 style="margin: 0; flex: 1;">üåæ Katoen Supply Chain - Complete Flow met USDT</h1>
            <a href="dpp-viewer.html" target="_blank" class="button button-success" style="text-decoration: none; width: auto; padding: 12px 24px; font-size: 15px;">üì± DPP Viewer</a>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="steps">
                <div class="step">
                    <div class="step-circle" id="step1">1</div>
                    <div class="step-label">DID Registratie<br>Stakeholders</div>
                </div>
                <div class="step">
                    <div class="step-circle" id="step2">2</div>
                    <div class="step-label">Katoen Oogst<br>& DPP Aanmaak</div>
                </div>
                <div class="step">
                    <div class="step-circle" id="step3">3</div>
                    <div class="step-label">Transport<br>& IoT Data</div>
                </div>
                <div class="step">
                    <div class="step-circle" id="step4">4</div>
                    <div class="step-label">Verwerking<br>Kwaliteitscheck</div>
                </div>
                <div class="step">
                    <div class="step-circle" id="step5">5</div>
                    <div class="step-label">USDT Betaling<br>& Bonus</div>
                </div>
                <div class="step">
                    <div class="step-circle" id="step6">6</div>
                    <div class="step-label">Complete<br>Tracking</div>
                </div>
            </div>
        </div>
        
        <!-- Account Info -->
        <div class="card">
            <h2>üë§ Account Selectie</h2>
            <div class="account-switcher">
                <button class="button button-small" onclick="selectAccount(0)">Account #0 (Admin)</button>
                <button class="button button-small button-success" onclick="selectAccount(1)">Account #1 (Boer)</button>
                <button class="button button-small button-warning" onclick="selectAccount(2)">Account #2 (Transporteur)</button>
                <button class="button button-small" onclick="selectAccount(3)">Account #3 (Certificeerder)</button>
                <button class="button button-small" onclick="selectAccount(4)">Account #4 (Fabriek)</button>
            </div>
            <div class="info-grid">
                <div class="info-item">
                    <strong>üîó Huidige Account</strong>
                    <span id="currentAccount">Niet verbonden</span>
                </div>
                <div class="info-item">
                    <strong>üí∞ ETH Balance</strong>
                    <span id="ethBalance">0 ETH</span>
                </div>
                <div class="info-item">
                    <strong>üíµ USDT Balance</strong>
                    <span id="usdtBalance">0 USDT</span>
                </div>
                <div class="info-item">
                    <strong>‚úÖ DID Status</strong>
                    <span id="didStatus">Geen DID</span>
                </div>
            </div>
        </div>
        
        <!-- Stap 1: DID Registratie voor ALLE Stakeholders -->
        <div class="card">
            <h2>1Ô∏è‚É£ Fase 1: DID Registratie voor Alle Stakeholders (Admin)</h2>
            <div class="alert alert-info">
                <strong>üìã Volgorde:</strong> Eerst moeten alle stakeholders (Boer, Transporteur, Certificeerder, Fabriek) een DID krijgen voordat de supply chain kan starten.
            </div>
            
            <h3>Registreer DID per Stakeholder</h3>
            <div class="form-group">
                <label>Kies Stakeholder</label>
                <select id="didStakeholderSelect" onchange="fillDIDAddress()">
                    <option value="">-- Selecteer --</option>
                    <option value="1">Account #1 - Boer</option>
                    <option value="2">Account #2 - Transporteur</option>
                    <option value="3">Account #3 - Certificeerder</option>
                    <option value="4">Account #4 - Fabriek</option>
                </select>
            </div>
            <div class="form-group">
                <label>Address (automatisch ingevuld)</label>
                <input type="text" id="didAddress" readonly placeholder="Selecteer eerst een stakeholder">
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Public Key (optioneel)</label>
                    <input type="text" id="didPublicKey" placeholder="0x..." value="0x1234...">
                </div>
                <div class="form-group">
                    <label>Type (automatisch)</label>
                    <input type="text" id="didType" readonly placeholder="Selecteer eerst een stakeholder">
                </div>
            </div>
            <button class="button button-success" onclick="registerDID()">Registreer DID voor Deze Stakeholder</button>
            
            <hr style="margin: 30px 0;">
            
            <h3>DID Status Overzicht</h3>
            <div id="didOverview">
                <button class="button button-small" onclick="checkAllDIDs()">Check DID Status Alle Stakeholders</button>
                <div id="didStatusList"></div>
            </div>
            
            <div id="didResult"></div>
        </div>
        
        <!-- Stap 2: VC Aanvraag (Optioneel) -->
        <div class="card">
            <h2>üìú Optioneel: Verifiable Credential Uitgeven (Certificeerder)</h2>
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Let op:</strong> Deze stap is optioneel. VC's kunnen aan batches worden gekoppeld voor extra certificering (bio, fairtrade, etc).
            </div>
            <div class="form-group">
                <label>Boer Address (Subject)</label>
                <input type="text" id="vcSubject" placeholder="0x...">
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Credential Type</label>
                    <select id="vcType">
                        <option value="OrganicCertificate">Bio Certificaat</option>
                        <option value="QualityCertificate">Kwaliteit Certificaat</option>
                        <option value="FairTradeCertificate">Fairtrade Certificaat</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Geldigheid (dagen)</label>
                    <input type="number" id="vcValidity" value="365">
                </div>
            </div>
            <div class="form-group">
                <label>Data (JSON)</label>
                <textarea id="vcData">{"issuer":"Bio Certificaat NL","score":95,"details":"Voldoet aan EU Bio normen"}</textarea>
            </div>
            <button class="button button-success" onclick="issueVC()">Geef VC Uit</button>
            <div id="vcResult"></div>
        </div>
        
        <!-- Stap 2: Batch Aanmaken -->
        <div class="card">
            <h2>2Ô∏è‚É£ Fase 2: Katoen Oogst & DPP Aanmaken (Boer)</h2>
            <div class="alert alert-info">
                <strong>üë®‚Äçüåæ Boer Taak:</strong> Registreer de geoogste katoen batch met gewicht, kwaliteit en herkomst. Dit cre√´ert een Digital Product Passport op de blockchain.
            </div>
            <div class="form-group">
                <label>Gewicht (kg)</label>
                <input type="number" id="batchWeight" value="500">
            </div>
            <div class="form-group">
                <label>Herkomst Locatie (GPS/Farm naam)</label>
                <input type="text" id="batchOrigin" value="Gujarat, India">
            </div>
            <div class="alert alert-warning">
                <strong>üìã DPP Bevat:</strong> GPS locatie, oogstdatum, gewicht, katoensoort, kwaliteitsscore (automatisch random 60-100), boer DID, optionele certificaten
            </div>
            <button class="button button-success" onclick="createBatch()">üåæ Maak Katoen Batch & DPP Aan</button>
            <div id="batchResult"></div>
            
            <hr style="margin: 30px 0;">
            <h3>Mijn Batches</h3>
            <button class="button button-small" onclick="loadMyBatches()">Ververs</button>
            <div id="myBatches"></div>
        </div>
        
        <!-- Stap 3: IoT Data -->
        <div class="card">
            <h2>3Ô∏è‚É£ Fase 3: Transport met IoT Monitoring (Transporteur)</h2>
            <div class="alert alert-info">
                <strong>üöõ Transport Taak:</strong> Track de batch en bekijk alle IoT sensor data die automatisch tijdens transport is geregistreerd (10-15 records met temp, vochtigheid, GPS).
            </div>
            <div class="form-group">
                <label>Batch ID om te Tracken</label>
                <input type="number" id="trackBatchId" placeholder="1">
            </div>
            <button class="button button-success" onclick="trackBatch()">ÔøΩ Track Batch & Bekijk IoT Data</button>
            <div id="trackResult"></div>
        </div>
        
        <!-- Stap 4: Kwaliteitscontrole -->
        <div class="card">
            <h2>4Ô∏è‚É£ Fase 4: Verwerking & Kwaliteitscontrole (Fabriek)</h2>
            <div class="alert alert-info">
                <strong>üè≠ Fabriek Taak:</strong> Na ontvangst controleert de fabriek/verwerker de kwaliteit en update de batch status.
            </div>
            <div class="form-group">
                <label>Batch ID</label>
                <input type="number" id="qualityBatchId" placeholder="1">
            </div>
            <div class="form-group">
                <label>Nieuwe Status</label>
                <select id="batchStatus">
                    <option value="1">Verified (Geverifieerd)</option>
                    <option value="2">In Transit (In Transport)</option>
                    <option value="3">Quality Checked (Kwaliteit Gecontroleerd)</option>
                    <option value="4">Delivered (Afgeleverd)</option>
                    <option value="5">Completed (Compleet)</option>
                </select>
            </div>
            <div class="alert alert-warning">
                <strong>üî¨ Kwaliteitsdata:</strong> Input/output gewicht, vezellengte, vezelsterkte, zuiverheid %, kleur grade, verwerkingsdatum, verwerker DID
            </div>
            <button class="button button-success" onclick="updateBatchStatus()">‚úÖ Update Batch Status</button>
            <div id="qualityResult"></div>
        </div>
        
        <!-- Stap 5: USDT Betaling -->
        <div class="card">
            <h2>5Ô∏è‚É£ USDT Betaling</h2>
            
            <div class="alert alert-info">
                <strong>üí° Tip:</strong> Gebruik eerst de faucet om gratis USDT te krijgen!
            </div>
            
            <button class="button button-warning" onclick="getUSDTFromFaucet()">üö∞ Faucet: Krijg 1000 USDT</button>
            
            <hr style="margin: 30px 0;">
            
            <h3>Betaal voor Batch</h3>
            <div class="form-group">
                <label>Batch ID</label>
                <input type="number" id="paymentBatchId" placeholder="1">
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Betaal Aan (Adres)</label>
                    <input type="text" id="paymentTo" placeholder="0x...">
                </div>
                <div class="form-group">
                    <label>Bedrag (USDT)</label>
                    <input type="number" id="paymentAmount" value="5000">
                </div>
            </div>
            <div class="form-group">
                <label>Reden</label>
                <select id="paymentReason">
                    <option value="harvest">Oogst Betaling</option>
                    <option value="transport">Transport Betaling</option>
                    <option value="processing">Verwerking Betaling</option>
                    <option value="other">Anders</option>
                </select>
            </div>
            <button class="button button-success" onclick="payForBatch()">Betaal met USDT</button>
            
            <hr style="margin: 30px 0;">
            
            <h3>Kwaliteitsbonus Betalen</h3>
            <div class="form-group">
                <label>Batch ID</label>
                <input type="number" id="bonusBatchId" placeholder="1">
            </div>
            <div class="alert alert-warning">
                <strong>Bonus Structuur:</strong><br>
                Kwaliteit 90-100: +30% | 70-89: +15% | Basis: 10 USDT/kg
            </div>
            <button class="button button-warning" onclick="payQualityBonus()">Betaal Kwaliteitsbonus</button>
            
            <div id="paymentResult"></div>
        </div>
        
        <!-- Batch Tracking -->
        <div class="card">
            <h2>6Ô∏è‚É£ Batch Tracking & Details</h2>
            <div class="form-group">
                <label>Batch ID</label>
                <input type="number" id="trackBatchId" placeholder="1">
            </div>
            <button class="button" onclick="trackBatch()">Track Batch</button>
            <div id="trackResult"></div>
        </div>
    </div>
    
    <script src="integrated-app.js"></script>
</body>
</html>
